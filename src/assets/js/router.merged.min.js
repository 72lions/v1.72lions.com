var Router=new function(){var d=true;var n={push:[],pop:[]};var p={};var q=null;var k=null;var h="";var f=true;this.basePath="";this.hashListenInterval=500;this.push=function(t,u,s){if(f){history.pushState(t,u,this.basePath+s)}q=j();i("push");if(f){b(q.path)}else{b(q.hash)}};this.replace=function(t,u,s){if(f){history.replaceState(t,u,this.basePath+s)}q=j();i("push");if(f){b(q.path)}else{b(q.hash)}};this.registerForEvent=function(t,v){var u=false;for(var s=n[t].length-1;s>=0;s--){if(n[t][s]===v){u=true;break}}if(!u){n[t].push(v)}u=null};this.registerForPathChange=function(w,x,u){u=u||0;w=this.basepath+w;var v=false;var s=p[w];if(s!==undefined){for(var t=s.length-1;t>=0;t--){if(s[t].callback===x){v=true;break}}}else{p[w]=[]}if(!v){p[w].push({callback:x,priority:u});r(w)}s=null;v=null};this.goBack=function(s){history.go(0-(s===null||s===undefined?1:s))};this.goForward=function(s){history.go(s===null||s===undefined?1:s)};this.getState=function(){return j()};var c=function(s){q=j();if(d){d=false}i("pop");if(f){b(q.path)}else{b(q.hash)}};var j=function(){var s=g(location.href);s.isRefresh=d;return s};var i=function(u){var s=n[u];for(var t=s.length-1;t>=0;t--){s[t](q)}s=null};var b=function(u){var s=p[u];if(s!==undefined){for(var t=s.length-1;t>=0;t--){s[t].callback(q)}}s=null};var r=function(t){var s=p[t];s.sort(e);s=null};var l=function(){var s=j().hash;if(h!==s){h=s;c(null)}};var g=function(t){t=unescape(t);var v=t.replace(/^(http(s)?:\/\/)?[^\/]+\/?/i,"");var x={protocol:t.match(/^(http(s)?):\/\//i),domain:t.match(/^(http(s)?:\/\/)?([^\/:]+)/i),query:t.match(/\?([\w\+\-\=&]+)/),port:t.match(/\w:(\d{1,5})/),hash:t.match(/#([\w\-\/]+)/),path:v.match(/^\/?([\w\-\/\.]+)/)};var s={protocol:x.protocol?x.protocol[1]:null,domain:x.domain?x.domain[3]:null,query:x.query?x.query[1]:null,port:x.port?x.port[1]:null,hash:x.hash?x.hash[1]:null,path:x.path?x.path[1]:null,url:t};if(s.path){s.pathSegments=s.path.replace(/^\/|\/$/g,"").split("/")}if(s.hash){s.hashSegments=s.hash.replace(/^\/|\/$/g,"").split("/")}if(s.query){s.params={};var u=/([\w\+\-]+)\=([\w\+\-]+)/g;var w=u.exec(s.query);while(w){s.params[w[1]]=w[2];w=u.exec(s.query)}}return s};var o=function(){return !!(window.history&&history.pushState)};var a=function(){return !!(window.onhashchange)};var e=function(u,t){var s=parseInt(u.priority,0);var v=parseInt(t.priority,0);return((s<v)?-1:((s>v)?1:0))};var m=function(){if(o()){window.onpopstate=c}else{f=false;if(a()){window.onhashchange=c}else{k=setInterval(function(){l()},this.hashListenInterval)}}};m()};